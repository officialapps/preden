import{i as F,b as K,c as xe,m as Z,d as Ee,f as S,r as k,g as Ae,p as J,h as Q}from"./index-D0Rvnp_g.js";import{Y as $e,Z as Se,$ as Ie,a0 as l,a1 as X,a2 as v,a3 as m,a4 as h,a5 as A,a6 as ee,a7 as Te,a8 as $,a9 as D,aa as B,ab as te,ac as Pe,ad as Me,ae as C,af as ze,ag as De,ah as Be,ai as Oe,aj as je,i as Ve,ak as U,g as T,al as _e,y as ke,am as Ce,an as q,ao as Le,k as g,ap as re,aq as Ne,ar as ne}from"./index-CmFym_Z-.js";class He extends Map{constructor(t){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=t}get(t){const r=super.get(t);return super.has(t)&&r!==void 0&&(this.delete(t),super.set(t,r)),r}set(t,r){if(super.set(t,r),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const Re={checksum:new He(8192)},V=Re.checksum;function w(e,t={}){const{as:r=typeof e=="string"?"Hex":"Bytes"}=t,n=$e(Se(e));return r==="Bytes"?n:Ie(n)}const Fe=/^0x[a-fA-F0-9]{40}$/;function O(e,t={}){const{strict:r=!0}=t;if(!Fe.test(e))throw new L({address:e,cause:new se});if(r){if(e.toLowerCase()===e)return;if(Ue(e)!==e)throw new L({address:e,cause:new We})}}function Ue(e){if(V.has(e))return V.get(e);O(e,{strict:!1});const t=e.substring(2).toLowerCase(),r=w(X(t),{as:"Bytes"}),n=t.split("");for(let a=0;a<40;a+=2)r[a>>1]>>4>=8&&n[a]&&(n[a]=n[a].toUpperCase()),(r[a>>1]&15)>=8&&n[a+1]&&(n[a+1]=n[a+1].toUpperCase());const s=`0x${n.join("")}`;return V.set(e,s),s}function P(e,t={}){const{strict:r=!0}=t??{};try{return O(e,{strict:r}),!0}catch{return!1}}class L extends l{constructor({address:t,cause:r}){super(`Address "${t}" is invalid.`,{cause:r}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}}class se extends l{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}}class We extends l{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}}function Ye({checksumAddress:e,parameters:t,values:r}){const n=[];for(let s=0;s<t.length;s++)n.push(W({checksumAddress:e,parameter:t[s],value:r[s]}));return n}function W({checksumAddress:e=!1,parameter:t,value:r}){const n=t,s=et(n.type);if(s){const[a,i]=s;return Ze(r,{checksumAddress:e,length:a,parameter:{...n,type:i}})}if(n.type==="tuple")return Xe(r,{checksumAddress:e,parameter:n});if(n.type==="address")return Ge(r,{checksum:e});if(n.type==="bool")return Ke(r);if(n.type.startsWith("uint")||n.type.startsWith("int")){const a=n.type.startsWith("int"),[,,i="256"]=F.exec(n.type)??[];return Je(r,{signed:a,size:Number(i)})}if(n.type.startsWith("bytes"))return qe(r,{type:n.type});if(n.type==="string")return Qe(r);throw new oe(n.type)}function Y(e){let t=0;for(let a=0;a<e.length;a++){const{dynamic:i,encoded:o}=e[a];i?t+=32:t+=v(o)}const r=[],n=[];let s=0;for(let a=0;a<e.length;a++){const{dynamic:i,encoded:o}=e[a];i?(r.push(m(t+s,{size:32})),n.push(o),s+=v(o)):r.push(o)}return h(...r,...n)}function Ge(e,t){const{checksum:r=!1}=t;return O(e,{strict:r}),{dynamic:!1,encoded:A(e.toLowerCase())}}function Ze(e,t){const{checksumAddress:r,length:n,parameter:s}=t,a=n===null;if(!Array.isArray(e))throw new rt(e);if(!a&&e.length!==n)throw new tt({expectedLength:n,givenLength:e.length,type:`${s.type}[${n}]`});let i=!1;const o=[];for(let u=0;u<e.length;u++){const c=W({checksumAddress:r,parameter:s,value:e[u]});c.dynamic&&(i=!0),o.push(c)}if(a||i){const u=Y(o);if(a){const c=m(o.length,{size:32});return{dynamic:!0,encoded:o.length>0?h(c,u):c}}if(i)return{dynamic:!0,encoded:u}}return{dynamic:!1,encoded:h(...o.map(({encoded:u})=>u))}}function qe(e,{type:t}){const[,r]=t.split("bytes"),n=v(e);if(!r){let s=e;return n%32!==0&&(s=$(s,Math.ceil((e.length-2)/2/32)*32)),{dynamic:!0,encoded:h(A(m(n,{size:32})),s)}}if(n!==Number.parseInt(r))throw new ae({expectedSize:Number.parseInt(r),value:e});return{dynamic:!1,encoded:$(e)}}function Ke(e){if(typeof e!="boolean")throw new l(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:A(ee(e))}}function Je(e,{signed:t,size:r}){if(typeof r=="number"){const n=2n**(BigInt(r)-(t?1n:0n))-1n,s=t?-n-1n:0n;if(e>n||e<s)throw new Te({max:n.toString(),min:s.toString(),signed:t,size:r/8,value:e.toString()})}return{dynamic:!1,encoded:m(e,{size:32,signed:t})}}function Qe(e){const t=D(e),r=Math.ceil(v(t)/32),n=[];for(let s=0;s<r;s++)n.push($(B(t,s*32,(s+1)*32)));return{dynamic:!0,encoded:h($(m(v(t),{size:32})),...n)}}function Xe(e,t){const{checksumAddress:r,parameter:n}=t;let s=!1;const a=[];for(let i=0;i<n.components.length;i++){const o=n.components[i],u=Array.isArray(e)?i:o.name,c=W({checksumAddress:r,parameter:o,value:e[u]});a.push(c),c.dynamic&&(s=!0)}return{dynamic:s,encoded:s?Y(a):h(...a.map(({encoded:i})=>i))}}function et(e){const t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}function j(e,t,r){const{checksumAddress:n=!1}={};if(e.length!==t.length)throw new ie({expectedLength:e.length,givenLength:t.length});const s=Ye({checksumAddress:n,parameters:e,values:t}),a=Y(s);return a.length===0?"0x":a}function N(e,t){if(e.length!==t.length)throw new ie({expectedLength:e.length,givenLength:t.length});const r=[];for(let n=0;n<e.length;n++){const s=e[n],a=t[n];r.push(N.encode(s,a))}return h(...r)}(function(e){function t(r,n,s=!1){if(r==="address"){const u=n;return O(u),A(u.toLowerCase(),s?32:0)}if(r==="string")return D(n);if(r==="bytes")return n;if(r==="bool")return A(ee(n),s?32:1);const a=r.match(F);if(a){const[u,c,d="256"]=a,f=Number.parseInt(d)/8;return m(n,{size:s?32:f,signed:c==="int"})}const i=r.match(K);if(i){const[u,c]=i;if(Number.parseInt(c)!==(n.length-2)/2)throw new ae({expectedSize:Number.parseInt(c),value:n});return $(n,s?32:0)}const o=r.match(xe);if(o&&Array.isArray(n)){const[u,c]=o,d=[];for(let f=0;f<n.length;f++)d.push(t(c,n[f],!0));return d.length===0?"0x":h(...d)}throw new oe(r)}e.encode=t})(N||(N={}));class tt extends l{constructor({expectedLength:t,givenLength:r,type:n}){super(`Array length mismatch for type \`${n}\`. Expected: \`${t}\`. Given: \`${r}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}}let ae=class extends l{constructor({expectedSize:t,value:r}){super(`Size of bytes "${r}" (bytes${v(r)}) does not match expected size (bytes${t}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}};class ie extends l{constructor({expectedLength:t,givenLength:r}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${t}`,`Given length (values): ${r}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}}class rt extends l{constructor(t){super(`Value \`${t}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}}class oe extends l{constructor(t){super(`Type \`${t}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}}function nt(e){const{domain:t,message:r,primaryType:n,types:s}=e,a=(i,o)=>{for(const u of i){const{name:c,type:d}=u,f=o[c],y=d.match(F);if(y&&(typeof f=="number"||typeof f=="bigint")){const[,x,I]=y;m(f,{signed:x==="int",size:Number.parseInt(I??"")/8})}if(d==="address"&&typeof f=="string"&&!P(f))throw new L({address:f,cause:new se});const p=d.match(K);if(p){const[,x]=p;if(x&&v(f)!==Number.parseInt(x))throw new ct({expectedSize:Number.parseInt(x),givenSize:v(f)})}const b=s[d];b&&(pt(d),a(b,f))}};if(s.EIP712Domain&&t){if(typeof t!="object")throw new ut({domain:t});a(s.EIP712Domain,t)}if(n!=="EIP712Domain")if(s[n])a(s[n],r);else throw new ft({primaryType:n,types:s})}function st(e){const{primaryType:t,types:r}=e;let n="";const s=de({primaryType:t,types:r});s.delete(t);const a=[t,...Array.from(s).sort()];for(const i of a)n+=`${i}(${(r[i]??[]).map(({name:o,type:u})=>`${u} ${o}`).join(",")})`;return n}function ce(e){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},typeof(e==null?void 0:e.chainId)=="number"&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function at(e){const{domain:t,types:r}=e;return it({data:t,primaryType:"EIP712Domain",types:{...r,EIP712Domain:(r==null?void 0:r.EIP712Domain)||ce(t)}})}function it(e){const{data:t,primaryType:r,types:n}=e,s=ue({data:t,primaryType:r,types:n});return w(s)}function ot(e){try{return nt(e),!0}catch{return!1}}class ct extends l{constructor({expectedSize:t,givenSize:r}){super(`Expected bytes${t}, got bytes${r}.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.BytesSizeMismatchError"})}}class ut extends l{constructor({domain:t}){super(`Invalid domain "${te(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidDomainError"})}}class ft extends l{constructor({primaryType:t,types:r}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(r))}\`.`,{metaMessages:["Check that the primary type is a key in `types`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidPrimaryTypeError"})}}class dt extends l{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"TypedData.InvalidStructTypeError"})}}function ue(e){const{data:t,primaryType:r,types:n}=e,s=[{type:"bytes32"}],a=[lt({primaryType:r,types:n})];for(const i of n[r]??[]){const[o,u]=fe({types:n,name:i.name,type:i.type,value:t[i.name]});s.push(o),a.push(u)}return j(s,a)}function lt(e){const{primaryType:t,types:r}=e,n=D(st({primaryType:t,types:r}));return w(n)}function fe(e){let{types:t,name:r,type:n,value:s}=e;if(t[n]!==void 0)return[{type:"bytes32"},w(ue({data:s,primaryType:n,types:t}))];if(n==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},w(s,{as:"Hex"})];if(n==="string")return[{type:"bytes32"},w(X(s),{as:"Hex"})];if(n.lastIndexOf("]")===n.length-1){const a=n.slice(0,n.lastIndexOf("[")),i=s.map(o=>fe({name:r,type:a,types:t,value:o}));return[{type:"bytes32"},w(j(i.map(([o])=>o),i.map(([,o])=>o)))]}return[{type:n},s]}function de(e,t=new Set){const{primaryType:r,types:n}=e,s=r.match(/^\w*/u),a=s==null?void 0:s[0];if(t.has(a)||n[a]===void 0)return t;t.add(a);for(const i of n[a])de({primaryType:i.type,types:n},t);return t}function pt(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new dt({type:e})}function yt(e,t={}){const{recovered:r}=t;if(typeof e.r>"u")throw new _({signature:e});if(typeof e.s>"u")throw new _({signature:e});if(r&&typeof e.yParity>"u")throw new _({signature:e});if(e.r<0n||e.r>Z)throw new mt({value:e.r});if(e.s<0n||e.s>Z)throw new gt({value:e.s});if(typeof e.yParity=="number"&&e.yParity!==0&&e.yParity!==1)throw new le({value:e.yParity})}function bt(e){yt(e);const t=e.r,r=e.s;return h(m(t,{size:32}),m(r,{size:32}),typeof e.yParity=="number"?m(ht(e.yParity),{size:1}):"0x")}function ht(e){if(e===0)return 27;if(e===1)return 28;throw new le({value:e})}class _ extends l{constructor({signature:t}){super(`Signature \`${te(t)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}}class mt extends l{constructor({value:t}){super(`Value \`${t}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}}class gt extends l{constructor({value:t}){super(`Value \`${t}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}}class le extends l{constructor({value:t}){super(`Value \`${t}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}}const wt="0x6492649264926492649264926492649264926492649264926492649264926492";function G({address:e,data:t,signature:r}){return Ee([S([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,t,r]),wt])}function vt(e){for(const t of e)if(typeof t!="string")return!1;return!0}function xt(e){return vt(e)?Pe(e):e}function H(e){let t=!0,r="",n=0,s="",a=!1;for(let i=0;i<e.length;i++){const o=e[i];if(["(",")",","].includes(o)&&(t=!0),o==="("&&n++,o===")"&&n--,!!t){if(n===0){if(o===" "&&["event","function","error",""].includes(s))s="";else if(s+=o,o===")"){a=!0;break}continue}if(o===" "){e[i-1]!==","&&r!==","&&r!==",("&&(r="",t=!1);continue}s+=o,r+=o}}if(!a)throw new l("Unable to normalize signature.");return s}function R(e,t){const r=typeof e,n=t.type;switch(n){case"address":return P(e,{strict:!1});case"bool":return r==="boolean";case"function":return r==="string";case"string":return r==="string";default:return n==="tuple"&&"components"in t?Object.values(t.components).every((s,a)=>R(Object.values(e)[a],s)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(n)?r==="number"||r==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(n)?r==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(n)?Array.isArray(e)&&e.every(s=>R(s,{...t,type:n.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function pe(e,t,r){for(const n in e){const s=e[n],a=t[n];if(s.type==="tuple"&&a.type==="tuple"&&"components"in s&&"components"in a)return pe(s.components,a.components,r[n]);const i=[s.type,a.type];if(i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?P(r[n],{strict:!1}):i.includes("address")&&i.includes("bytes")?P(r[n],{strict:!1}):!1)return i}}function Et(e,t,r){const{args:n=[],prepare:s=!0}=r??{},a=Me(t,{strict:!1}),i=e.filter(c=>a?c.type==="function"||c.type==="error"?ye(c)===B(t,0,4):c.type==="event"?E(c)===t:!1:"name"in c&&c.name===t);if(i.length===0)throw new M({name:t});if(i.length===1)return{...i[0],...s?{hash:E(i[0])}:{}};let o;for(const c of i){if(!("inputs"in c))continue;if(!n||n.length===0){if(!c.inputs||c.inputs.length===0)return{...c,...s?{hash:E(c)}:{}};continue}if(!c.inputs||c.inputs.length===0||c.inputs.length!==n.length)continue;if(n.every((f,y)=>{const p="inputs"in c&&c.inputs[y];return p?R(f,p):!1})){if(o&&"inputs"in o&&o.inputs){const f=pe(c.inputs,o.inputs,n);if(f)throw new $t({abiItem:c,type:f[0]},{abiItem:o,type:f[1]})}o=c}}const u=(()=>{if(o)return o;const[c,...d]=i;return{...c,overloads:d}})();if(!u)throw new M({name:t});return{...u,...s?{hash:E(u)}:{}}}function ye(e){return B(E(e),0,4)}function At(e){const t=typeof e=="string"?e:C(e);return H(t)}function E(e){return typeof e!="string"&&"hash"in e&&e.hash?e.hash:w(D(At(e)))}class $t extends l{constructor(t,r){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${t.type}\` in \`${H(C(t.abiItem))}\`, and`,`\`${r.type}\` in \`${H(C(r.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}}class M extends l{constructor({name:t,data:r,type:n="item"}){const s=t?` with name "${t}"`:r?` with data "${r}"`:"";super(`ABI ${n}${s} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}}function St(e,t){var s;const{bytecode:r,args:n}=t;return h(r,(s=e.inputs)!=null&&s.length&&(n!=null&&n.length)?j(e.inputs,n):"0x")}function It(e){const t=e.find(r=>r.type==="constructor");if(!t)throw new M({name:"constructor"});return t}function Tt(e,...t){const{overloads:r}=e,n=r?be([e,...r],e.name,{args:t[0]}):e,s=Pt(n),a=t.length>0?j(n.inputs,t[0]):void 0;return a?h(s,a):s}function be(e,t,r){const n=Et(e,t,r);if(n.type!=="function")throw new M({name:t,type:"function"});return n}function Pt(e){return ye(e)}const Mt="0x6492649264926492649264926492649264926492649264926492649264926492",zt="0x608060405234801561001057600080fd5b5060405161069438038061069483398101604081905261002f9161051e565b600061003c848484610048565b9050806000526001601ff35b60007f64926492649264926492649264926492649264926492649264926492649264926100748361040c565b036101e7576000606080848060200190518101906100929190610577565b60405192955090935091506000906001600160a01b038516906100b69085906105dd565b6000604051808303816000865af19150503d80600081146100f3576040519150601f19603f3d011682016040523d82523d6000602084013e6100f8565b606091505b50509050876001600160a01b03163b60000361016057806101605760405162461bcd60e51b815260206004820152601e60248201527f5369676e617475726556616c696461746f723a206465706c6f796d656e74000060448201526064015b60405180910390fd5b604051630b135d3f60e11b808252906001600160a01b038a1690631626ba7e90610190908b9087906004016105f9565b602060405180830381865afa1580156101ad573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906101d19190610633565b6001600160e01b03191614945050505050610405565b6001600160a01b0384163b1561027a57604051630b135d3f60e11b808252906001600160a01b03861690631626ba7e9061022790879087906004016105f9565b602060405180830381865afa158015610244573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102689190610633565b6001600160e01b031916149050610405565b81516041146102df5760405162461bcd60e51b815260206004820152603a602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e6174757265206c656e6774680000000000006064820152608401610157565b6102e7610425565b5060208201516040808401518451859392600091859190811061030c5761030c61065d565b016020015160f81c9050601b811480159061032b57508060ff16601c14155b1561038c5760405162461bcd60e51b815260206004820152603b602482015260008051602061067483398151915260448201527f3a20696e76616c6964207369676e617475726520762076616c756500000000006064820152608401610157565b60408051600081526020810180835289905260ff83169181019190915260608101849052608081018390526001600160a01b0389169060019060a0016020604051602081039080840390855afa1580156103ea573d6000803e3d6000fd5b505050602060405103516001600160a01b0316149450505050505b9392505050565b600060208251101561041d57600080fd5b508051015190565b60405180606001604052806003906020820280368337509192915050565b6001600160a01b038116811461045857600080fd5b50565b634e487b7160e01b600052604160045260246000fd5b60005b8381101561048c578181015183820152602001610474565b50506000910152565b600082601f8301126104a657600080fd5b81516001600160401b038111156104bf576104bf61045b565b604051601f8201601f19908116603f011681016001600160401b03811182821017156104ed576104ed61045b565b60405281815283820160200185101561050557600080fd5b610516826020830160208701610471565b949350505050565b60008060006060848603121561053357600080fd5b835161053e81610443565b6020850151604086015191945092506001600160401b0381111561056157600080fd5b61056d86828701610495565b9150509250925092565b60008060006060848603121561058c57600080fd5b835161059781610443565b60208501519093506001600160401b038111156105b357600080fd5b6105bf86828701610495565b604086015190935090506001600160401b0381111561056157600080fd5b600082516105ef818460208701610471565b9190910192915050565b828152604060208201526000825180604084015261061e816060850160208701610471565b601f01601f1916919091016060019392505050565b60006020828403121561064557600080fd5b81516001600160e01b03198116811461040557600080fd5b634e487b7160e01b600052603260045260246000fdfe5369676e617475726556616c696461746f72237265636f7665725369676e6572",Dt=[{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[{name:"_signer",type:"address"},{name:"_hash",type:"bytes32"},{name:"_signature",type:"bytes"}],outputs:[{type:"bool"}],stateMutability:"nonpayable",type:"function",name:"isValidSig"}];function Bt(e){if(B(e,-32)!==Mt)throw new jt(e)}function Ot(e){try{return Bt(e),!0}catch{return!1}}class jt extends l{constructor(t){super(`Value \`${t}\` is an invalid ERC-6492 wrapped signature.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"WrappedSignature.InvalidWrappedSignatureError"})}}const Vt="0x1626ba7e",_t=[{type:"bytes32",name:"hash"},{type:"bytes",name:"signature"}],kt=[{type:"bytes4"}];async function Ct(e){return k({contract:e.contract,method:[Vt,_t,kt],params:[e.hash,e.signature]})}function Lt(e,t){const r={to:t};switch(r.to){case"number":return Rt(e,r);case"bigint":return Nt(e,r);case"boolean":return Ht(e,r);case"string":return Ft(e,r);default:return ze(e,r)}}function Nt(e,t={}){return Oe(e,t)}function Ht(e,t={}){return Be(e,t)}function Rt(e,t={}){return je(e,t)}function Ft(e,t={}){return De(e,t)}const Ut="0xfB688330379976DA81eB64Fe4BF50d7401763B9C";async function he({hash:e,signature:t,address:r,client:n,chain:s,accountFactory:a}){const i=(()=>{if(Ve(t))return t;if(typeof t=="object"&&"r"in t&&"s"in t)return bt(t);if(t instanceof Uint8Array)return Lt(t,"hex");throw new Error(`Invalid signature type for signature ${t}: ${typeof t}`)})();if(await U(T({address:r,client:n,chain:s}))&&await z({hash:e,signature:i,contract:T({chain:s,address:r,client:n})}).catch(b=>(console.error("Error verifying EIP-1271 signature",b),!1)))return!0;const u=await(async()=>!a||Ot(i)?i:G({address:a.address,data:a.verificationCalldata,signature:i}))();let c;const d=await _e(s),f=xt(Dt);if(d)c={to:Ut,data:Tt(be(f,"isValidSig"),[r,e,u])};else{const p=It(f);c={data:St(p,{args:[r,e,u],bytecode:zt})}}const y=ke({chain:s,client:n});try{const p=await Ae(y,c);return Ce(p)}catch{return!!await z({hash:e,signature:i,contract:T({chain:s,address:r,client:n})}).catch(b=>(console.error("Error verifying EIP-1271 signature",b),!1))}}const Wt="0x1626ba7e";async function z({hash:e,signature:t,contract:r}){try{return await Ct({hash:e,signature:t,contract:r})===Wt}catch(n){return console.error("Error verifying EIP-1271 signature",n),!1}}const Yt=`Ethereum Signed Message:
`;function Gt(e,t){const r=typeof e=="string"?q(e):e.raw instanceof Uint8Array?e.raw:Le(e.raw),n=q(`${Yt}${r.length}`);return g(re(n,r),t)}function Zt(e){const{domain:t={},message:r,primaryType:n}=e,s={EIP712Domain:ce(t),...e.types};ot({domain:t,message:r,primaryType:n,types:s});const a=["0x1901"];if(t&&a.push(at({domain:t,types:s})),n!=="EIP712Domain"){const i=(()=>{const o=me({data:r,primaryType:n,types:s});return g(o)})();a.push(i)}return g(re(...a.map(i=>Ne(i))))}function me({data:e,primaryType:t,types:r}){const n=[{type:"bytes32"}],s=[qt({primaryType:t,types:r})];if(!r[t])throw new Error("Invalid types");for(const a of r[t]){const[i,o]=we({types:r,name:a.name,type:a.type,value:e[a.name]});n.push(i),s.push(o)}return S(n,s)}function qt({primaryType:e,types:t}){const r=ne(Kt({primaryType:e,types:t}));return g(r)}function Kt({primaryType:e,types:t}){let r="";const n=ge({primaryType:e,types:t});n.delete(e);const s=[e,...Array.from(n).sort()];for(const a of s){if(!t[a])throw new Error("Invalid types");r+=`${a}(${t[a].map(({name:i,type:o})=>`${o} ${i}`).join(",")})`}return r}function ge({primaryType:e,types:t},r=new Set){const n=e.match(/^\w*/u),s=n==null?void 0:n[0];if(r.has(s)||t[s]===void 0)return r;r.add(s);for(const a of t[s])ge({primaryType:a.type,types:t},r);return r}function we({types:e,name:t,type:r,value:n}){if(e[r]!==void 0)return[{type:"bytes32"},g(me({data:n,primaryType:r,types:e}))];if(r==="bytes")return n=`0x${(n.length%2?"0":"")+n.slice(2)}`,[{type:"bytes32"},g(n)];if(r==="string")return[{type:"bytes32"},g(ne(n))];if(r.lastIndexOf("]")===r.length-1){const s=r.slice(0,r.lastIndexOf("[")),a=n.map(i=>we({name:t,type:s,types:e,value:i}));return[{type:"bytes32"},g(S(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:r},n]}async function tr({accountContract:e,factoryContract:t,options:r,message:n}){var u,c;const s=Gt(n),a=await ve({factoryContract:t,accountContract:e,originalMsgHash:s});let i;if(a){const d=S([{type:"bytes32"}],[s]);i=await r.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:r.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:d}})}else i=await r.personalAccount.signMessage({message:n});if(await U(e)){if(await z({hash:s,signature:i,contract:e}))return i;throw new Error("Failed to verify signature")}else{const d=J({factoryContract:t,adminAddress:r.personalAccount.address,accountSalt:(u=r.overrides)==null?void 0:u.accountSalt,createAccountOverride:(c=r.overrides)==null?void 0:c.createAccount});if(!d)throw new Error("Create account override not provided");const f=await Q(d),y=G({address:t.address,data:f,signature:i});if(await he({hash:s,signature:y,address:e.address,chain:e.chain,client:e.client}))return y;throw new Error("Unable to verify ERC-6492 signature after signing.")}}async function rr({accountContract:e,factoryContract:t,options:r,typedData:n}){var c,d,f,y,p;if(((d=(c=n.domain)==null?void 0:c.verifyingContract)==null?void 0:d.toLowerCase())===((f=e.address)==null?void 0:f.toLowerCase()))return r.personalAccount.signTypedData(n);const a=Zt(n),i=await ve({factoryContract:t,accountContract:e,originalMsgHash:a});let o;if(i){const b=S([{type:"bytes32"}],[a]);o=await r.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:r.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:b}})}else o=await r.personalAccount.signTypedData(n);if(await U(e)){if(await z({hash:a,signature:o,contract:e}))return o;throw new Error("Failed to verify signature")}else{const b=J({factoryContract:t,adminAddress:r.personalAccount.address,accountSalt:(y=r.overrides)==null?void 0:y.accountSalt,createAccountOverride:(p=r.overrides)==null?void 0:p.createAccount});if(!b)throw new Error("Create account override not provided");const x=await Q(b),I=G({address:t.address,data:x,signature:o});if(await he({hash:a,signature:I,address:e.address,chain:e.chain,client:e.client}))return I;throw new Error("Unable to verify signature on smart account, please make sure the admin wallet has permissions and the signature is valid.")}}async function ve({factoryContract:e,accountContract:t,originalMsgHash:r}){try{const n=await k({contract:e,method:"function accountImplementation() public view returns (address)"});return await k({contract:T({address:n,chain:t.chain,client:t.client}),method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[r]}).then(a=>a!=="0x").catch(()=>!1)}catch{return!1}}export{tr as smartAccountSignMessage,rr as smartAccountSignTypedData};
