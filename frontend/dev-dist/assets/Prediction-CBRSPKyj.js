import{B as rt,j as e,U as at,D as ot,E as it,F as lt,G as ct,I as s,J as et,K as tt,L as Le,M as st,N as Xe,O as ut,P as dt,Q as ft,T as nt,V as G,W as pt,X as mt}from"./index-CmFym_Z-.js";class gt extends rt{constructor({value:S}){super(`Number \`${S}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function Ce(c,S){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(c))throw new gt({value:c});let[o,u="0"]=c.split(".");const d=o.startsWith("-");if(d&&(o=o.slice(1)),u=u.replace(/(0+)$/,""),S===0)Math.round(+`.${u}`)===1&&(o=`${BigInt(o)+1n}`),u="";else if(u.length>S){const[O,z,E]=[u.slice(0,S-1),u.slice(S-1,S),u.slice(S)],w=Math.round(+`${z}.${E}`);w>9?u=`${BigInt(O)+BigInt(1)}0`.padStart(O.length+1,"0"):u=`${O}${w}`,u.length>S&&(u=u.slice(1),o=`${BigInt(o)+1n}`),u=u.slice(0,S)}else u=u.padEnd(S,"0");return BigInt(`${d?"-":""}${o}${u}`)}const bt=({categoryIcon:c,question:S,yesPercentage:o=70,noPercentage:u=30,votes:d="05",timeLeft:O="20 hrs 56 mins left",showBorder:z=!0,optionA:E="Yes",optionB:w="No"})=>e.jsxs("div",{className:`bg-[#09113b] rounded-xl ${z?"border border-[#18DDF7]":""} px-4 py-2 mt-2 mb-6`,children:[e.jsxs("div",{className:"flex items-center gap-3 mt-2 mb-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-sm bg-[#01052D] flex items-center justify-center text-white text-lg",children:c}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:S})]}),e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"relative w-full h-10 rounded-full bg-[#18DDF71A] overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-y-0 flex items-center gap-2 font-semibold text-white left-5",children:[e.jsx("span",{children:E}),e.jsx("img",{src:at,alt:"Up Icon",className:"w-4 h-4"})]}),e.jsx("div",{className:"absolute inset-y-0 flex items-center font-semibold text-white right-2",children:e.jsxs("span",{children:[o,"%"]})}),e.jsx("div",{className:"h-full bg-[#18DDF7] opacity-50",style:{width:`${o}%`}})]})}),e.jsx("div",{children:e.jsxs("div",{className:"relative w-full h-10 rounded-full bg-[#FF5A5A1A] overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-y-0 flex items-center gap-2 font-semibold text-white left-5",children:[e.jsx("span",{children:w}),e.jsx("img",{src:ot,alt:"Down Icon",className:"w-4 h-4"})]}),e.jsx("div",{className:"absolute inset-y-0 flex items-center font-semibold text-white right-2",children:e.jsxs("span",{children:[u,"%"]})}),e.jsx("div",{className:"h-full bg-[#FF5A5A] opacity-30",style:{width:`${u}%`}})]})}),e.jsx("div",{className:"flex items-center justify-center mt-2",children:e.jsx("span",{className:"text-gray-100",children:O})}),e.jsxs("div",{className:"flex items-center justify-between mt-2 text-sm text-gray-400",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:it,alt:"User icon"}),e.jsxs("div",{className:"flex items-center gap-2 text-transparent bg-clip-text bg-gradient-to-r from-[#00FFFF] to-[#27FE60]",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full"}),e.jsx("span",{children:d}),e.jsx("span",{children:"Votes"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{children:O}),e.jsx(lt,{data:{text:"Web Share - GfG",url:"https://www.stimapp.com",title:"Preden PVP"},onClick:()=>console.log("shared successfully!"),children:e.jsx("button",{className:"flex items-center justify-center",children:e.jsx("img",{src:ct,alt:"share icon",className:"w-4 h-4"})})})]})]})]}),ht="data:image/svg+xml,%3csvg%20width='15'%20height='14'%20viewBox='0%200%2015%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.02176%201.3022C7.17542%200.990908%207.25225%200.835262%207.35655%200.785532C7.44729%200.742266%207.55272%200.742266%207.64347%200.785532C7.74776%200.835262%207.82459%200.990908%207.97825%201.3022L9.43604%204.25551C9.4814%204.34741%209.50408%204.39336%209.53723%204.42904C9.56658%204.46063%209.60177%204.48622%209.64087%204.5044C9.68503%204.52494%209.73573%204.53235%209.83714%204.54717L13.098%205.02379C13.4414%205.07398%2013.6131%205.09908%2013.6925%205.18295C13.7616%205.25592%2013.7942%205.35619%2013.781%205.45584C13.7659%205.57038%2013.6416%205.69144%2013.393%205.93358L11.0343%208.23094C10.9608%208.30255%2010.924%208.33836%2010.9003%208.38096C10.8793%208.41869%2010.8658%208.46013%2010.8606%208.50299C10.8547%208.5514%2010.8634%208.60199%2010.8808%208.70315L11.4373%2011.9481C11.496%2012.2903%2011.5254%2012.4614%2011.4702%2012.563C11.4222%2012.6513%2011.3369%2012.7133%2011.238%2012.7316C11.1244%2012.7527%2010.9707%2012.6719%2010.6634%2012.5103L7.74825%2010.9772C7.65742%2010.9294%207.612%2010.9056%207.56416%2010.8962C7.52179%2010.8879%207.47822%2010.8879%207.43586%2010.8962C7.38801%2010.9056%207.3426%2010.9294%207.25177%2010.9772L4.33661%2012.5103C4.02927%2012.6719%203.8756%2012.7527%203.76198%2012.7316C3.66312%2012.7133%203.57781%2012.6513%203.52982%2012.563C3.47466%2012.4614%203.50401%2012.2903%203.56271%2011.9481L4.11925%208.70315C4.1366%208.60199%204.14528%208.5514%204.13941%208.50299C4.13421%208.46013%204.12074%208.41869%204.09973%208.38096C4.07601%208.33836%204.03925%208.30255%203.96572%208.23094L1.60703%205.93358C1.35844%205.69144%201.23414%205.57038%201.21901%205.45584C1.20585%205.35619%201.23836%205.25592%201.3075%205.18295C1.38695%205.09908%201.55864%205.07398%201.90202%205.02379L5.16287%204.54717C5.26428%204.53235%205.31498%204.52494%205.35914%204.5044C5.39824%204.48622%205.43344%204.46063%205.46279%204.42904C5.49593%204.39336%205.51861%204.34741%205.56398%204.25551L7.02176%201.3022Z'%20stroke='%2318DDF7'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",Ze=[{constant:!0,inputs:[],name:"decimals",outputs:[{name:"",type:"uint8"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"spender",type:"address"},{name:"value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"}],kt=(c,S,o,u=6)=>{const[d,O]=s.useState(!1),[z,E]=s.useState(!1),[w,Z]=s.useState(null),[v,re]=s.useState(null),[L,de]=s.useState(null),{writeContractAsync:J}=et(),{isLoading:D,isSuccess:ae}=tt({hash:w,enabled:!!w}),{data:I,refetch:$}=Le({address:c,abi:Ze,functionName:"allowance",args:[o,S],enabled:!!o&&!!c&&!0}),{data:ee,refetch:te}=Le({address:c,abi:Ze,functionName:"balanceOf",args:[o],enabled:!!o&&!!c}),Q=s.useCallback(y=>{if(!y||!I)return!1;try{const F=Ce(y.toString(),u);return I>=F}catch(F){return console.error("Error comparing allowance:",F),!1}},[I,u]);s.useEffect(()=>{if(v&&I){const y=Q(v);O(y),ae&&y&&E(!1)}},[I,Q,v,ae]),s.useEffect(()=>{ae&&w&&(console.log("Approval transaction confirmed:",w),Z(null),E(!1),v&&($(),O(!0)))},[ae,w,v,$]);const n=async y=>{var F,_;try{if(!y||Number.parseFloat(y)<=0)throw new Error("Invalid amount");if(!o)throw new Error("Wallet not connected");E(!0),re(y);const M=Ce(y.toString(),u),B=await J({address:c,abi:Ze,functionName:"approve",args:[S,M]});return Z(B),{success:!0,hash:B}}catch(M){console.error("Approval error:",M),E(!1),re(null);let B="Approval failed";return(F=M.message)!=null&&F.includes("User rejected")?B="Transaction was rejected":(_=M.message)!=null&&_.includes("insufficient funds")?B="Insufficient funds for gas fee":M.message&&(B=`Approval failed: ${M.message}`),de(B),{success:!1,error:B}}};return{isApproved:d,pendingApproval:z,isApprovalPending:D,isApprovalSuccess:ae,userBalance:ee||BigInt(0),allowance:I,error:L,approveToken:n,checkIfApproved:Q,refetchAllowance:$,refetchBalance:te,setError:de,clearError:()=>de(null)}},xt=[{type:"function",name:"stake",inputs:[{name:"_option",type:"uint8",internalType:"uint8"},{name:"_amount",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"}],yt=(c,S,o=18)=>{const[u,d]=s.useState(!1),[O,z]=s.useState(null),[E,w]=s.useState(null),[Z,v]=s.useState(null),[re,L]=s.useState(!1),{writeContractAsync:de,error:J,isPending:D}=et(),{isLoading:ae,isSuccess:I,error:$}=tt({hash:O,enabled:!!O});return s.useEffect(()=>{I&&O&&!re&&(console.log("‚úÖ Stake transaction confirmed:",O),L(!0),d(!1),w(null))},[I,O,re]),s.useEffect(()=>{(J||$)&&(console.error("‚ùå Transaction error:",J||$),d(!1),w((J==null?void 0:J.message)||($==null?void 0:$.message)||"Transaction failed"))},[J,$]),{pendingStake:u,isStakePending:ae||D,isStakeSuccess:I&&re,error:E,debugInfo:Z,transactionCompleted:re,stakeHash:O,placeStake:async(n,y,F,_,M,B,R=null)=>{var U,b,me,ie,se,fe,V,f;try{if(console.log("=== üöÄ STARTING ENHANCED STAKE TRANSACTION ==="),console.log("üìù Input parameters:",{optionValue:n,amount:y,eventAddress:c,userAddress:S,tokenDecimals:o,amountInWei:R==null?void 0:R.toString()}),w(null),v(null),L(!1),!c||!S)throw new Error("Missing required addresses");if(!y||Number.parseFloat(y)<=0)throw new Error("Invalid stake amount");if(n!==0&&n!==1)throw new Error("Invalid option value (must be 0 or 1)");if(F&&(console.log("üîç Event validation:",{status:F.status,isOpenForBetting:F.isOpenForBetting,hasEnded:F.hasEnded}),!F.isOpenForBetting)){let T="Event is not accepting stakes";throw F.isPending?T="Event is still pending approval":F.isClosed||F.isCompleted?T="Event is closed for betting":F.hasEnded&&(T="Event has already ended"),new Error(T)}const p=R||Ce(y.toString(),o);if(console.log("üí∞ Amount conversion:",{originalAmount:y,decimals:o,amountInWei:p.toString()}),_){const T=Number(_)/Math.pow(10,o),x=Number.parseFloat(y);if(console.log("üíº Balance check:",{userBalance:T,stakeAmount:x,hasEnoughBalance:T>=x}),T<x)throw new Error(`Insufficient balance. You have ${T.toFixed(4)} but need ${x}`)}if(M){const T=Number(M)/Math.pow(10,o),x=Number.parseFloat(y);if(console.log("üîì Allowance check:",{allowance:T,stakeAmount:x,hasEnoughAllowance:T>=x}),T<x)throw new Error(`Insufficient allowance. Approved: ${T.toFixed(4)}, needed: ${x}`)}console.log("‚úÖ All validations passed. Proceeding with stake transaction..."),d(!0);const h=Number(n);console.log("üìû Calling stake function:",{contract:c,function:"stake",args:[h,p.toString()]});const C=await de({address:c,abi:xt,functionName:"stake",args:[h,p]});return console.log("‚úÖ Stake transaction submitted:",C),z(C),{success:!0,hash:C,debugInfo:{optionValue:h,amount:p.toString(),eventAddress:c,userAddress:S}}}catch(p){console.error("=== ‚ùå STAKING ERROR ===",p),d(!1),L(!1);let h="Staking failed";if((U=p.message)!=null&&U.includes("User rejected")||(b=p.message)!=null&&b.includes("user rejected"))h="Transaction was rejected by user";else if((me=p.message)!=null&&me.includes("insufficient funds"))h="Insufficient ETH for gas fee";else if((ie=p.message)!=null&&ie.includes("execution reverted")||(se=p.message)!=null&&se.includes("reverted")){h="Transaction reverted by smart contract";const C=p.message.toLowerCase();C.includes("event not open")||C.includes("not approved")?h+=" - Event is not open for betting":C.includes("insufficient allowance")||C.includes("allowance")?h+=" - Token allowance insufficient":C.includes("insufficient balance")||C.includes("balance")?h+=" - Token balance insufficient":C.includes("invalid option")?h+=" - Invalid betting option":C.includes("already staked")||C.includes("already placed")?h+=" - User has already placed a stake":C.includes("amount")?h+=" - Invalid stake amount":h+=" - Check event status and your balance"}else(fe=p.message)!=null&&fe.includes("network")?h="Network error - please try again":(V=p.message)!=null&&V.includes("chainId")||(f=p.message)!=null&&f.includes("chain")?h="Wrong network - please switch to Base Sepolia":p.message&&(h=p.message);return w(h),{success:!1,error:h,debugInfo:{originalError:p.message,stack:p.stack}}}},runDebugCheck:async(n,y,F,_,M,B,R=null)=>{try{console.log("üîç Running debug check...");const U=R||Ce(y.toString(),o),b={inputs:{optionValue:n,amount:y,amountInWei:U.toString(),eventAddress:c,userAddress:S,tokenAddress:B,tokenDecimals:o},validation:{hasValidAddress:!!c&&!!S,hasValidAmount:y&&Number.parseFloat(y)>0,hasValidOption:n===0||n===1,eventIsOpen:(F==null?void 0:F.isOpenForBetting)||!1,hasBalance:_?Number(_)/Math.pow(10,o)>=Number.parseFloat(y):"unknown",hasAllowance:M?Number(M)/Math.pow(10,o)>=Number.parseFloat(y):"unknown"},summary:{canStake:!0,mainBlocker:null}};return b.validation.hasValidAddress?b.validation.hasValidAmount?b.validation.hasValidOption?b.validation.eventIsOpen?b.validation.hasBalance===!1?(b.summary.canStake=!1,b.summary.mainBlocker="Insufficient balance"):b.validation.hasAllowance===!1&&(b.summary.canStake=!1,b.summary.mainBlocker="Insufficient allowance"):(b.summary.canStake=!1,b.summary.mainBlocker="Event is not open for betting"):(b.summary.canStake=!1,b.summary.mainBlocker="Invalid option value"):(b.summary.canStake=!1,b.summary.mainBlocker="Invalid stake amount"):(b.summary.canStake=!1,b.summary.mainBlocker="Missing required addresses"),console.log("üîç Debug result:",b),v(b),b}catch(U){return console.error("‚ùå Debug check failed:",U),{error:U.message,inputs:{optionValue:n,amount:y,eventAddress:c,userAddress:S,tokenAddress:B},summary:{canStake:!1,mainBlocker:"Debug check failed"}}}},clearTransactionState:()=>{console.log("üîÑ Clearing staking transaction state"),z(null),d(!1),L(!1),w(null),v(null)},setError:w,clearError:()=>{w(null),v(null)}}},He=[{type:"function",name:"getEventDetails",inputs:[],outputs:[{name:"question",type:"string",internalType:"string"},{name:"description",type:"string",internalType:"string"},{name:"options",type:"string[]",internalType:"string[]"},{name:"eventType",type:"string",internalType:"string"},{name:"category",type:"string",internalType:"string"},{name:"eventImage",type:"string",internalType:"string"},{name:"status",type:"uint8",internalType:"enum EventContract.EventStatus"},{name:"endTime",type:"uint256",internalType:"uint256"},{name:"winningOption",type:"uint8",internalType:"uint8"},{name:"creator",type:"address",internalType:"address"},{name:"tokenAddress",type:"address",internalType:"address"},{name:"creatorStake",type:"uint256",internalType:"uint256"},{name:"totalStaked",type:"uint256",internalType:"uint256"},{name:"creatorFeePercentage",type:"uint256",internalType:"uint256"},{name:"creatorRewardClaimed",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"getOptionTotals",inputs:[],outputs:[{name:"",type:"uint256[]",internalType:"uint256[]"}],stateMutability:"view"},{type:"function",name:"getUserStake",inputs:[{name:"_user",type:"address",internalType:"address"}],outputs:[{name:"selectedOption",type:"uint8",internalType:"uint8"},{name:"amount",type:"uint256",internalType:"uint256"},{name:"claimed",type:"bool",internalType:"bool"}],stateMutability:"view"},{type:"function",name:"getStakersCount",inputs:[],outputs:[{name:"",type:"uint256",internalType:"uint256"}],stateMutability:"view"},{type:"function",name:"stake",inputs:[{name:"_option",type:"uint8",internalType:"uint8"},{name:"_amount",type:"uint256",internalType:"uint256"}],outputs:[],stateMutability:"nonpayable"}],X={PENDING:0,APPROVED:1,CLOSED:2,COMPLETED:3,CANCELLED:4,REJECTED:5,NULLIFIED:5},St={[X.PENDING]:"Pending approval",[X.APPROVED]:"Open for betting",[X.CLOSED]:"Closed for betting",[X.COMPLETED]:"Completed",[X.CANCELLED]:"Cancelled",[X.REJECTED]:"Rejected",[X.NULLIFIED]:"Nullified"},we={["0x337610d27c682E347C9cD60BD4b3b107C9d34dDd".toLowerCase()]:{name:"STIM",symbol:"STIM",decimals:18,icon:"stim-coin.png"},["0x64544969ed7EBf5f083679233325356EbE738930".toLowerCase()]:{name:"USDC",symbol:"USDC",decimals:6,icon:"USDC.svg"}},vt=(c,S,o)=>{const{address:u}=st(),[d,O]=s.useState(o||null),[z,E]=s.useState([]),[w,Z]=s.useState(S),[v,re]=s.useState(()=>{const t=(S==null?void 0:S.toLowerCase())||"0x337610d27c682E347C9cD60BD4b3b107C9d34dDd".toLowerCase();return we[t]||we["0x337610d27c682E347C9cD60BD4b3b107C9d34dDd".toLowerCase()]}),[L,de]=s.useState(null),[J,D]=s.useState(!1),[ae,I]=s.useState(!0),[$,ee]=s.useState(null),[te,Q]=s.useState(!1),[n,y]=s.useState(!1),[F,_]=s.useState(null),[M,B]=s.useState(null),[R,U]=s.useState(null),[b,me]=s.useState(null),[ie,se]=s.useState(!1),fe=s.useRef(0),V=s.useRef(!1),f=kt(w,c,u,v.decimals),p=yt(c,u,v.decimals),h=s.useCallback((t,a=0)=>{if(t==null)return a;if(typeof t=="number"&&!isNaN(t))return t;if(typeof t=="string"){const m=Number.parseFloat(t);return isNaN(m)?a:m}return typeof t=="bigint"?Number(t):a},[]),C=s.useCallback((t,a="")=>t==null?a:typeof t=="string"?t:String(t),[]),T=s.useCallback(t=>!t||t==="0x0"||t==="0x0000000000000000000000000000000000000000"?S:t,[S]),{data:x,isError:ne,isLoading:Ne,refetch:Se}=Le({address:c,abi:He,functionName:"getEventDetails",enabled:!0,retry:3,retryDelay:1e3}),{data:j,isError:Y,isLoading:ge,refetch:ve}=Le({address:c,abi:He,functionName:"getOptionTotals",enabled:!0,retry:3,retryDelay:1e3}),{data:r,isError:Ge,refetch:W}=Le({address:c,abi:He,functionName:"getUserStake",args:[u],enabled:!!u}),{data:be,refetch:Ae}=Le({address:c,abi:He,functionName:"getStakersCount",enabled:!0}),le=s.useCallback(()=>{const t=Date.now();if(t-fe.current<2e3)return;fe.current=t,["refreshBalance","refreshWalletBalance","forceBalanceRefetch"].forEach(m=>{window.dispatchEvent(new CustomEvent(m,{detail:{source:"usePrediction",timestamp:t}}))}),localStorage.setItem("balanceNeedsRefresh","true"),localStorage.setItem("refreshReason","stake_success"),localStorage.setItem("refreshTimestamp",t.toString()),f.refetchBalance&&f.refetchBalance()},[f]),pe=s.useCallback(()=>{Se(),ve(),W(),Ae(),f.refetchAllowance(),f.refetchBalance()},[c,Se,ve,W,Ae,f]),Ee=s.useCallback(async()=>{try{f.refetchBalance&&await f.refetchBalance(),f.refetchAllowance&&await f.refetchAllowance(),le()}catch(t){console.error("Error refreshing balance:",t)}},[f,le]);s.useEffect(()=>{if(p.isStakeSuccess&&ie&&!te&&(Q(!0),_(null),B(null),se(!1),pe(),le(),setTimeout(()=>{le(),Ee()},3e3),setTimeout(()=>{le(),Ee()},6e3),window.dispatchEvent(new CustomEvent("stakeSuccess",{detail:{amount:R,option:b,eventAddress:c,timestamp:Date.now()}})),setTimeout(()=>{y(!0)},2e3)),(p.error||f.error)&&ie&&!te){const t=p.error||f.error;_(t),B(p.error),Q(!0),se(!1),setTimeout(()=>{y(!0)},500)}},[p.isStakeSuccess,p.error,f.error,te,ie,pe,le,Ee,R,b,c]),s.useEffect(()=>{if(w){const t=w.toLowerCase(),a=we[t];a?(re(a),console.log("ü™ô Token configuration updated:",{address:w,name:a.name,symbol:a.symbol,decimals:a.decimals})):(console.warn(`‚ö†Ô∏è Unknown token address: ${w}`),re(we["0x337610d27c682E347C9cD60BD4b3b107C9d34dDd".toLowerCase()]))}},[w]),s.useEffect(()=>{if(r&&u){const[t,a,m]=r,k=h(a,0);de({selectedOption:h(t,0),amount:k,claimed:!!m}),D(k>0),console.log("üë§ User stake status:",{hasStaked:k>0,selectedOption:h(t,0),amount:k,claimed:!!m})}else D(!1),de(null)},[r,u,h]),s.useEffect(()=>{if(o&&(Ne||ge||!x)){console.log("Using initial event data while blockchain loads...");const t=T(o.tokenAddress);Z(t);const a=t.toLowerCase();we[a]||(console.warn(`Unsupported token address in initial data: ${t}`),Z(S));const m={...o,tokenAddress:t,isOpenForBetting:!0,statusMessage:"Loading from blockchain...",isPending:!1,isApproved:!0,isClosed:!1,isCompleted:!1,isCancelled:!1,isRejected:!1,isNullified:!1,hasEnded:!1};O(m),I(!1);return}if(!Ne&&!ge&&x&&j)try{const t=C(x[0],"Unknown Question"),a=C(x[1],"No description available"),m=Array.isArray(x[2])?x[2]:["Yes","No"],k=C(x[3],"binary"),q=C(x[4],"general"),H=C(x[5],""),N=h(x[6],0),ke=h(x[7],Math.floor(Date.now()/1e3)),je=h(x[8],0),_e=C(x[9],"0x0"),ue=C(x[10],S),Ve=h(x[11],0),Me=h(x[12],0),Ye=h(x[13],0),We=!!x[14],xe=T(ue);Z(xe);const Re=xe.toLowerCase();if(!we[Re]){ee(`Unsupported token address: ${xe}. Only STIM and USDC are supported.`),I(!1);return}const Fe=Array.isArray(j)?j.map(qe=>h(qe,0)):[0,0];E(Fe);const Be=new Date(ke*1e3),Pe=new Date>=Be,Ie={question:t,description:a,options:{A:m[0]||"Yes",B:m[1]||"No"},category:typeof(o==null?void 0:o.category)=="object"?o.category:{label:q,id:"0"},status:N,statusMessage:St[N]||"Unknown status",end_time:Be,winningOption:je,creator:_e,tokenAddress:xe,totalStaked:Me,yes_votes:Fe[0]||0,no_votes:Fe[1]||0,stakersCount:h(be,0),creatorStake:Ve,creatorFeePercentage:Ye,creatorRewardClaimed:We,eventType:k,eventImage:H,isPending:N===X.PENDING,isApproved:N===X.APPROVED,isOpenForBetting:N===X.APPROVED&&!Pe,isClosed:N===X.CLOSED,isCompleted:N===X.COMPLETED,isCancelled:N===X.CANCELLED,isRejected:N===X.REJECTED,isNullified:N===X.NULLIFIED,hasEnded:Pe};console.log("üìä Event data processed from blockchain:",{tokenAddress:xe,tokenConfig:we[Re],totalStaked:Me,status:Ie.statusMessage,isOpenForBetting:Ie.isOpenForBetting,endTime:Be,hasEnded:Pe}),O(Ie),I(!1),ee(null)}catch(t){console.error("Error processing event data:",t),ee("Error processing event data: "+t.message),I(!1)}if(!Ne&&ne||!ge&&Y){if(console.error("Error loading event data",{eventError:ne,totalsError:Y}),o){console.log("Using initial event data due to blockchain error");const t=T(o.tokenAddress);Z(t);const a={...o,tokenAddress:t,statusMessage:"Unable to verify on blockchain",isOpenForBetting:!0};O(a),ee("Unable to verify event status on blockchain, but you can still attempt to stake")}else ee("Failed to load event data from the blockchain");I(!1)}},[x,j,be,Ne,ge,ne,Y,c,T,S,o,h,C]);const Ue=t=>{if(!t)return"0";try{const a=typeof t=="bigint"?t:BigInt(t.toString()),m=Xe(a,v.decimals);console.log("formatTokenAmount debug:",{input:t.toString(),tokenDecimals:v.decimals,tokenSymbol:v.symbol,formatUnitsResult:m});const k=parseFloat(m);return k<1&&k>0?parseFloat(k.toFixed(8)).toString():k.toFixed(2)}catch(a){try{const m=t.toString();let k;if(m.includes("."))k=parseFloat(m);else{const q=Number(m);k=q/Math.pow(10,v.decimals),console.log("Manual conversion fallback:",{input:q,decimals:v.decimals,result:k})}return k<1&&k>0?parseFloat(k.toFixed(8)).toString():k.toFixed(2)}catch{return console.warn("Error formatting token amount:",a,"Amount:",t),"0"}}},ze=()=>{if(!(d!=null&&d.end_time))return"0 hrs 0 mins left";try{const t=new Date;let a;if(d.end_time instanceof Date)a=d.end_time;else if(typeof d.end_time=="string")a=new Date(d.end_time);else if(typeof d.end_time=="number")a=new Date(d.end_time*1e3);else return console.warn("Invalid end_time format:",d.end_time),"Invalid time";const m=a-t;if(console.log("Time calculation in prediction:",{now:t.toISOString(),endTime:a.toISOString(),timeLeft:m,timeLeftInMinutes:m/(1e3*60),timeLeftInHours:m/(1e3*60*60),timeLeftInDays:m/(1e3*60*60*24)}),m<=0)return"Ended";const k=Math.floor(m/(1e3*60*60*24)),q=Math.floor(m%(1e3*60*60*24)/(1e3*60*60)),H=Math.floor(m%(1e3*60*60)/(1e3*60));return k>0?`${k}d ${q}h left`:q>0?`${q}h ${H}m left`:H>0?`${H}m left`:"< 1m left"}catch(t){return console.error("Error calculating time left:",t),"Invalid time"}},Te=(t,a=!1)=>{if(!d)return{yesPercentage:0,noPercentage:0};let m=parseFloat(Xe(BigInt(d.yes_votes||0),v.decimals)),k=parseFloat(Xe(BigInt(d.no_votes||0),v.decimals));if(a&&R){const H=parseFloat(R);t==="optionA"?m+=H:t==="optionB"&&(k+=H)}const q=m+k;return q===0?{yesPercentage:50,noPercentage:50}:{yesPercentage:Math.round(m/q*100),noPercentage:Math.round(k/q*100)}},Ke=t=>{const{yesPercentage:a,noPercentage:m}=Te(t,!0),k=t==="optionA"?a:m,q=k===0?2:100/k,H=Math.round((q-1)*100);return Math.max(H,0)},Je=t=>d?(d.stakersCount||0)+(t?1:0):0;s.useEffect(()=>{const t=$||f.error||p.error;t&&ee(t)},[$,f.error,p.error]);const De=s.useCallback(()=>{Q(!1),y(!1),_(null),B(null),se(!1),U(null),me(null),V.current=!1,p.clearTransactionState&&p.clearTransactionState(),f.clearError&&f.clearError()},[p,f]),he=async(t,a,m=null)=>{try{if(V.current)return{success:!1,message:"Transaction already in progress"};if(V.current=!0,De(),!a||Number.parseFloat(a)<=0)return V.current=!1,{success:!1,message:"Invalid stake amount"};if(!d)return V.current=!1,{success:!1,message:"Event data not loaded"};if(J&&L){if(L.selectedOption!==t)return V.current=!1,{success:!1,message:`You cannot change your prediction. You previously staked ${Ue(L.amount)} ${v.symbol} on ${d.options.A==="Yes"?L.selectedOption===0?"Yes":"No":L.selectedOption===0?d.options.A:d.options.B}. You can only add more to the same option.`,opposingChoice:!0};console.log(`üëç User adding to existing ${L.selectedOption===0?"Yes":"No"} stake`)}U(a),me(t===0?"optionA":"optionB");const k=Ce(a.toString(),v.decimals);if(!d.isOpenForBetting){let N="Event is not accepting stakes";return d.isPending?N="Event is still pending approval. Please wait for moderator approval.":d.isClosed||d.isCompleted?N="This event is closed for betting. Staking is no longer available.":d.isCancelled?N="This event has been cancelled.":d.isRejected?N="This event has been rejected.":d.isNullified?N="This event has been nullified.":d.hasEnded&&(N="Event has already ended. Staking is no longer available."),V.current=!1,{success:!1,message:N,eventClosed:!0}}if(await f.refetchAllowance(),!f.checkIfApproved(a)){let N;const ke=v.symbol==="USDC";m?N=m:ke?N=a:N=Math.max(Number.parseFloat(a)*10,1e3).toString(),console.log("üîê Token approval strategy:",{tokenSymbol:v.symbol,isUSDC:ke,requestedAmount:a,approvalAmount:N,strategy:ke?"exact amount":"bulk approval",isAdditionalStake:J});const je=await f.approveToken(N);return je.success?(V.current=!1,{success:!0,needsConfirmation:!0,message:"Approval submitted, waiting for confirmation..."}):(V.current=!1,{success:!1,message:je.error||"Token approval failed"})}se(!0);const H=await p.placeStake(t,a,d,f.userBalance,f.allowance,w,k);return H.success?{success:!0,needsConfirmation:!0,message:J?"Additional stake transaction submitted!":"Stake transaction submitted!"}:(se(!1),V.current=!1,{success:!1,message:H.error||"Staking transaction failed"})}catch(k){return console.error("Approve and stake error:",k),se(!1),V.current=!1,{success:!1,message:k.message||"Transaction failed"}}},ce=s.useCallback(t=>{if(!t||!f.allowance)return!1;try{const a=Ce(t.toString(),v.decimals),m=f.allowance>=a;return console.log("üîç Approval check:",{amount:t,amountInWei:a.toString(),currentAllowance:f.allowance.toString(),isApproved:m,tokenSymbol:v.symbol}),m}catch(a){return console.error("Error checking approval:",a),!1}},[f.allowance,v.decimals,v.symbol]);return{eventData:d,optionTotals:z,tokenAddress:w,tokenConfig:v,userStake:L,hasUserStaked:J,loading:ae,error:$,isApproved:f.isApproved,userBalance:f.userBalance,allowance:f.allowance,pendingApproval:f.pendingApproval,pendingStake:p.pendingStake,isApprovalPending:f.isApprovalPending,isApprovalSuccess:f.isApprovalSuccess,isStakePending:p.isStakePending,isStakeSuccess:p.isStakeSuccess,transactionComplete:te,navigationReady:n,transactionError:F,stakingError:M,stakingInProgress:ie,lastStakeAmount:R,lastBetOption:b,approveToken:f.approveToken,placeStake:(t,a)=>p.placeStake(t,a,d,f.userBalance,f.allowance,w,Ce(a.toString(),v.decimals)),refreshEventData:pe,refreshUserBalance:Ee,checkIfApproved:ce,approveAndStake:he,resetTransactionState:De,formatTokenAmount:Ue,getTimeLeft:ze,calculatePercentages:Te,calculatePotentialWinnings:Ke,calculateTotalVotes:Je,clearError:()=>{ee(null),_(null),B(null),f.clearError(),p.clearError()}}},Oe="0x337610d27c682E347C9cD60BD4b3b107C9d34dDd",$e={["0x337610d27c682E347C9cD60BD4b3b107C9d34dDd".toLowerCase()]:{name:"USDT",symbol:"USDT",decimals:18,icon:nt},["0x64544969ed7EBf5f083679233325356EbE738930".toLowerCase()]:{name:"USDC",symbol:"USDC",decimals:6,icon:ft}},Nt=()=>{var We,xe,Re,Fe,Be,Qe,Pe,Ie,qe;const[c,S]=s.useState(""),[o,u]=s.useState(""),[d,O]=s.useState(!1),[z,E]=s.useState(null),[w,Z]=s.useState(!1),v=s.useRef(null),re=s.useRef(null),L=ut(),{state:de}=dt(),{address:J}=st(),{betOption:D="optionA",predictionId:ae,eventAddress:I,eventData:$,question:ee,options:te}=de||{},Q=D==="optionA"?0:1,{eventData:n,userBalance:y,loading:F,error:_,pendingApproval:M,pendingStake:B,isApprovalPending:R,isStakePending:U,isStakeSuccess:b,approveAndStake:me,getTimeLeft:ie,calculatePotentialWinnings:se,calculateTotalVotes:fe,clearError:V,transactionComplete:f,navigationReady:p,resetTransactionState:h,transactionError:C,stakingError:T,stakingInProgress:x,lastStakeAmount:ne,lastBetOption:Ne,refreshUserBalance:Se,hasUserStaked:j,userStake:Y,checkIfApproved:ge}=vt(I||"0x0000000000000000000000000000000000000000",Oe,$),ve=s.useCallback(()=>{if(v.current){const i=v.current,g=i.scrollHeight,A=i.clientHeight;g>A&&i.scrollTo({top:g-A,behavior:"smooth"})}},[]);s.useEffect(()=>{const i=setTimeout(()=>{ve()},100);return()=>clearTimeout(i)},[o,z,c,ve]),s.useEffect(()=>{const i=setTimeout(()=>{ve()},300);return()=>clearTimeout(i)},[ve]);const r=s.useMemo(()=>{const i=n||$||{question:ee||"Loading question...",options:te||{A:"Option A",B:"Option B"},category:{label:"Unknown",id:"0"},totalStaked:"0",end_time:new Date().toISOString(),status:1,statusMessage:"Loading..."};return te&&typeof te=="object"&&(i.options=te),console.log("Display Event Data:",i),i},[n,$,ee,te]),Ge=I&&I!=="0x0000000000000000000000000000000000000000",W=s.useCallback(()=>!j||!Y?!1:Y.selectedOption!==Q,[j,Y,Q]),be=s.useCallback(()=>{var g,A;return!j||!Y?"":Y.selectedOption===0?((g=r.options)==null?void 0:g.A)||"Option A":((A=r.options)==null?void 0:A.B)||"Option B"},[j,Y,r.options]),Ae=s.useCallback(()=>{var i,g;return Q===0?((i=r.options)==null?void 0:i.A)||"Option A":((g=r.options)==null?void 0:g.B)||"Option B"},[Q,r.options]),le=s.useCallback((i,g=!1)=>{if(!i||i==="0")return"0";try{const K=((n==null?void 0:n.tokenAddress)||(r==null?void 0:r.tokenAddress)||Oe).toLowerCase(),ye=$e[K],l=(ye==null?void 0:ye.decimals)||18;let P;const oe=i.toString();return oe.includes(".")?P=parseFloat(oe):P=Number(oe)/Math.pow(10,l),g||P<1&&P>0?parseFloat(P.toFixed(8)).toString():P.toFixed(2)}catch(A){return console.error("Error formatting token amount:",A),"0"}},[n==null?void 0:n.tokenAddress,r==null?void 0:r.tokenAddress]),pe=s.useCallback(i=>{if(!i)return"0.00";try{const A=((n==null?void 0:n.tokenAddress)||(r==null?void 0:r.tokenAddress)||Oe).toLowerCase(),K=$e[A],ye=(K==null?void 0:K.decimals)||18,l=i.toString();if(l.includes(".")){const oe=parseFloat(l);return oe<1&&oe>0?oe.toFixed(6):oe.toFixed(2)}const P=Number(l)/Math.pow(10,ye);return P<1&&P>0?parseFloat(P.toFixed(6)).toString():P.toFixed(2)}catch(g){return console.error("Error formatting balance:",g),"0.00"}},[n==null?void 0:n.tokenAddress,r==null?void 0:r.tokenAddress]),Ee=s.useCallback(i=>{if(!i)return"0";try{const A=((n==null?void 0:n.tokenAddress)||(r==null?void 0:r.tokenAddress)||Oe).toLowerCase(),K=$e[A],ye=(K==null?void 0:K.decimals)||18;let l;const P=i.toString();return P.includes(".")?l=parseFloat(P):l=Number(P)/Math.pow(10,ye),l>=1e6?`${(l/1e6).toFixed(1)}M`:l>=1e3?`${(l/1e3).toFixed(1)}K`:l>=1?l.toFixed(2):l>0?parseFloat(l.toFixed(8)).toString():"0"}catch(g){return console.error("Error formatting volume:",g),"0"}},[n==null?void 0:n.tokenAddress,r==null?void 0:r.tokenAddress]),Ue=s.useCallback(()=>{try{const i=fe&&fe(D);return i>1e6?Math.max(1,Math.floor(i/1e6)):Math.max(1,i||1)}catch(i){return console.error("Error calculating vote count:",i),1}},[fe,D]),ze=s.useCallback(()=>{if(!n)return{yesPercentage:50,noPercentage:50};try{const i=Number(n.yes_votes||0),g=Number(n.no_votes||0),A=i+g;return A===0?{yesPercentage:50,noPercentage:50}:{yesPercentage:Math.round(i/A*100),noPercentage:Math.round(g/A*100)}}catch(i){return console.error("Error calculating percentages:",i),{yesPercentage:50,noPercentage:50}}},[n]),Te=s.useCallback(()=>{["refreshBalance","refreshWalletBalance","forceBalanceRefetch"].forEach(g=>{window.dispatchEvent(new CustomEvent(g))}),Se&&Se(),localStorage.setItem("balanceNeedsRefresh","true")},[Se]),Ke=async(i,g)=>{try{if(!J)return E("Please connect your wallet first"),G.error("Please connect your wallet first"),{success:!1,message:"Please connect your wallet first"};if(!g||Number.parseFloat(g)<=0)return E("Please enter a valid stake amount"),G.error("Please enter a valid stake amount"),{success:!1,message:"Invalid stake amount"};if(!I)return E("Event address not found"),G.error("Event address not found"),{success:!1,message:"Event address not found"};if(j&&W()){const l=be(),P=Ae(),oe=`You cannot change your prediction. You previously staked on "${l}" and cannot switch to "${P}".`;return E(oe),G.error(`Cannot switch from "${l}" to "${P}"`),{success:!1,message:oe}}if(!r.isOpenForBetting&&n&&!n.isOpenForBetting){let l="Event is not accepting stakes";return n.isPending?l="Event is still pending approval. Please wait for moderator approval.":n.isClosed||n.isCompleted?l="This event is closed for betting. Staking is no longer available.":n.isCancelled?l="This event has been cancelled.":n.isRejected?l="This event has been rejected.":n.isNullified?l="This event has been nullified.":n.hasEnded&&(l="Event has already ended. Staking is no longer available."),E(l),G.error(l),{success:!1,message:l,eventClosed:!0}}const A=Number.parseFloat(g),K=pe(y);if(A>Number.parseFloat(K)){const l=`Insufficient balance. You have ${K} ${ue}`;return E(l),G.error(l),{success:!1,message:l}}if(E(null),Z(!1),h(),!ge(g)){u("Requesting token approval...");try{const l=await me(i,g,g);return l.success||l.needsConfirmation?(u("Approval submitted! Button will update when confirmed."),G.success("Approval transaction submitted! Click the button again to stake after confirmation."),{success:!0,message:"Approval transaction submitted"}):(E(l.message||"Approval failed"),G.error(l.message||"Approval failed"),l)}catch(l){return console.error("Approval error:",l),E("Approval failed: "+l.message),G.error("Approval failed: "+l.message),{success:!1,message:"Approval failed"}}}else{u("Placing your stake...");try{const l=await me(i,g);if(l.success||l.needsConfirmation){const P=j?"Additional stake transaction submitted!":"Stake transaction submitted!";G.success(P),u("Stake submitted! Waiting for confirmation...")}else E(l.message||"Transaction failed"),G.error(l.message||"Transaction failed");return l}catch(l){console.error("Stake error:",l);const P=`Stake failed: ${l.message||"Unknown error"}`;return E(P),G.error(P),{success:!1,message:P}}}}catch(A){console.error("Transaction error:",A);const K=`Transaction failed: ${A.message||"Unknown error"}`;return E(K),G.error(K),{success:!1,message:K}}};s.useEffect(()=>{_&&(E(_.message||"Failed to load event data from the blockchain"),V())},[_,V]),s.useEffect(()=>{const i=setTimeout(()=>O(!0),1e4);return()=>clearTimeout(i)},[]),s.useEffect(()=>{w||p&&f&&(b&&!C&&!T?(u("Stake placed successfully! Refreshing balance..."),Z(!0),G.success("Stake placed successfully!"),Te(),setTimeout(()=>{Te()},2e3),setTimeout(()=>{Te()},5e3),setTimeout(()=>{L("/prediction-success",{state:{betOption:D,stake:ne||c,predictionId:ae,question:r.question,timeLeft:ie(),potentialWinnings:se(D),eventAddress:I,eventData:n||$,betSuccess:!0,isAdditionalStake:j},replace:!0})},1e3)):(C||T)&&(u("Transaction failed! Please try again."),E(C||T),G.error(C||T||"Transaction failed"),Z(!1),setTimeout(()=>{h()},3e3)))},[p,f,b,C,T,w,L,D,c,ne,ae,r.question,I,n,$,ie,se,h,Se,j]),s.useEffect(()=>{w||(M||R?u("Confirming approval..."):B||U?u("Confirming stake..."):b&&!p?u("Stake successful! Redirecting..."):C||T?u("Transaction failed. Please try again."):!M&&!B&&!R&&!U&&!b&&o&&!o.includes("Success")&&!o.includes("Redirect")&&!o.includes("failed")&&u(""))},[M,B,R,U,b,p,C,T,o,w]);const Je=s.useCallback(()=>{if(x||U||R){G.warning("Transaction in progress. Please wait...");return}h&&h(),Z(!1),L("/predict")},[x,U,R,h,L]),De=s.useCallback(i=>{const g=i.target.value;/^\d*\.?\d*$/.test(g)&&(S(g),E(null))},[]),he=M||B||R||U||x,ce=f&&p,t=C||T,a=()=>j&&W()?"Cannot Change Prediction":j&&!W()?ce?b&&!t?"Success! Redirecting...":t?"Transaction Failed - Retry":"Redirecting...":he?M||R?"Approving Tokens...":B||U?"Adding to Stake...":"Processing...":n&&!n.isOpenForBetting?"Event Closed":c&&!ge(c)?"Approve Tokens":"Add to Stake":ce?b&&!t?"Success! Redirecting...":t?"Transaction Failed - Retry":"Redirecting...":he?M||R?"Approving Tokens...":B||U?"Placing Stake...":"Processing...":n&&!n.isOpenForBetting?"Event Closed":c&&!ge(c)?"Approve Tokens":"Place Stake",m=async()=>{if(j&&W()){const i=be(),g=Ae(),A=`You cannot change your prediction. You previously staked on "${i}" and cannot switch to "${g}".`;E(A),G.error(`Cannot switch from "${i}" to "${g}"`);return}he||ce&&b&&!t||await Ke(Q,c)},k=n&&!n.isOpenForBetting,q=pe(y),H=Number.parseFloat(c||"0")<=Number.parseFloat(q),N=j&&W(),ke=Ge&&!N&&!k&&H&&c&&Number.parseFloat(c)>0&&!he&&!(ce&&b&&!t),je=s.useCallback(()=>{if(!y)return"0.00";if(ne&&x){const i=parseFloat(pe(y)),g=parseFloat(ne);return Math.max(0,i-g).toFixed(2)}return pe(y)},[y,ne,x,pe]),_e=s.useCallback(()=>ne&&x,[ne,x]),ue=s.useMemo(()=>{const g=((n==null?void 0:n.tokenAddress)||(r==null?void 0:r.tokenAddress)||Oe).toLowerCase(),A=$e[g];return A?A.symbol:"USDT"},[n==null?void 0:n.tokenAddress,r==null?void 0:r.tokenAddress]),Ve=s.useCallback(()=>{const g=((n==null?void 0:n.tokenAddress)||(r==null?void 0:r.tokenAddress)||Oe).toLowerCase(),A=$e[g];return A?A.icon:nt},[n==null?void 0:n.tokenAddress,r==null?void 0:r.tokenAddress]);if(!Ge)return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60",children:e.jsx("div",{className:"w-full max-w-md bg-[#0B122E] rounded-[20px] border-2 border-[#18DDF7] p-6 text-center",children:e.jsxs("div",{className:"text-red-500",children:[e.jsx("p",{className:"mb-4",children:"Invalid Event Address"}),e.jsx("p",{className:"mb-6 text-sm text-gray-400",children:"No event address provided"}),e.jsx("button",{className:"px-4 py-2 bg-[#18DDF7] text-black rounded-full hover:bg-opacity-90",onClick:()=>L("/predict"),children:"Go back"})]})})});if(F&&!(r!=null&&r.question))return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60",children:e.jsx("div",{className:"w-full max-w-md bg-[#0B122E] rounded-[20px] border-2 border-[#18DDF7] p-6 text-center",children:e.jsxs("div",{className:"text-white",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full border-4 border-t-[#18DDF7] border-r-transparent border-b-transparent border-l-transparent animate-spin mx-auto mb-4"}),e.jsx("p",{children:"Loading prediction details..."})]}),d&&e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"mb-2 text-yellow-400",children:"Taking longer than expected"}),e.jsx("button",{className:"px-4 py-2 bg-[#18DDF7] text-black rounded-full hover:bg-opacity-90",onClick:()=>L("/predict"),children:"Go back"})]})]})})});if(!(r!=null&&r.question))return e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60",children:e.jsx("div",{className:"w-full max-w-md bg-[#0B122E] rounded-[20px] border-2 border-[#18DDF7] p-6 text-center",children:e.jsxs("div",{className:"text-red-500",children:[e.jsx("p",{className:"mb-4",children:"Error loading prediction"}),e.jsx("p",{className:"mb-6 text-sm text-gray-400",children:z||"Event data could not be retrieved"}),e.jsx("button",{className:"px-4 py-2 bg-[#18DDF7] text-black rounded-full hover:bg-opacity-90",onClick:()=>L("/predict"),children:"Go back"})]})})});const{yesPercentage:Me,noPercentage:Ye}=ze();return console.log("Prediction Debug:",{betOption:D,optionValue:Q,displayEventData:r.options,yesPercentage:Me,noPercentage:Ye,tokenAddress:(n==null?void 0:n.tokenAddress)||(r==null?void 0:r.tokenAddress),tokenSymbol:ue,category:r.category}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-60",children:e.jsx("div",{ref:v,className:"relative w-full max-w-md bg-[#0B122E] rounded-[20px] border-2 border-[#18DDF7] p-6 max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{ref:re,children:[e.jsxs("div",{className:"flex items-center justify-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:j&&!W()?"Add to Your Bet":"Place Your Bet"}),e.jsx("button",{className:"absolute right-4 bg-[#1A1F3F] rounded-full p-2 hover:bg-opacity-80",onClick:Je,disabled:x||U||R,children:e.jsx("img",{src:pt,alt:"close"})})]}),j&&e.jsxs("div",{className:`p-3 rounded-lg mb-4 text-center ${W()?"bg-red-900 bg-opacity-20 text-red-400 border border-red-500/30":"bg-blue-900 bg-opacity-20 text-blue-400 border border-blue-500/30"}`,children:[e.jsx("p",{className:"font-medium",children:W()?"‚ö†Ô∏è Cannot change your prediction":"üí∞ Your existing stake"}),e.jsxs("p",{className:"mt-1 text-sm",children:["You have ",le(Y.amount,!0)," ",ue,' staked on "',be(),'"']}),W()&&e.jsxs("p",{className:"mt-2 text-xs text-red-300",children:['You cannot switch to "',Ae(),'". You can only add more to your "',be(),'" stake.']}),!W()&&e.jsx("p",{className:"mt-2 text-xs text-blue-300",children:"You can add more to this stake below"})]}),k&&e.jsx("div",{className:"p-3 mb-4 text-center text-red-400 bg-red-900 rounded-lg bg-opacity-20",children:n.hasEnded?"Event has ended. Staking is no longer available.":`This event is ${((We=r.statusMessage)==null?void 0:We.toLowerCase())||"closed"}.`}),e.jsx(bt,{categoryIcon:e.jsx("div",{className:"w-10 h-10 rounded-sm bg-[#01052D] flex items-center justify-center text-[#18DDF7]",children:e.jsx(mt,{categoryName:(xe=r.category)==null?void 0:xe.name,categoryLabel:(Re=r.category)==null?void 0:Re.label,className:"w-5 h-5"})}),question:r.question,yesPercentage:Me,noPercentage:Ye,votes:Ue(),timeLeft:ie(),showBorder:!0,status:r.statusMessage,optionA:((Fe=r.options)==null?void 0:Fe.A)||"Option A",optionB:((Be=r.options)==null?void 0:Be.B)||"Option B"}),e.jsxs("div",{className:"mt-6 mb-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("label",{className:"block mb-2 text-sm text-gray-400",children:j&&!W()?"Additional Stake":"Stake"}),e.jsxs("span",{className:"block mb-2 text-sm text-gray-400",children:["Balance:"," ",e.jsxs("span",{className:`${H?"text-gray-300":"text-red-400"} ${_e()?"text-yellow-400":""}`,children:[je()," ",ue,_e()&&" (pending)"]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:c,onChange:De,placeholder:k?"Cannot stake":N?"Cannot change prediction":j?"Enter additional stake amount":"Enter stake amount",className:`w-full p-3 bg-[#1A1F3F] text-white rounded-xl placeholder-gray-500 ${!H&&c?"border border-red-500":""} ${k||he||N||ce&&b&&!t?"opacity-50 cursor-not-allowed":""}`,disabled:he||k||N||ce&&b&&!t}),e.jsxs("div",{className:"absolute flex items-center gap-2 transform -translate-y-1/2 right-3 top-1/2",children:[e.jsx("span",{className:"text-gray-400",children:ue}),e.jsx("img",{src:Ve(),alt:ue,className:"w-6 h-6"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-transparent bg-clip-text bg-gradient-to-r from-[#00FFFF] to-[#27FE60]",children:[e.jsx("img",{src:Ve(),alt:ue,className:"w-4 h-4"}),e.jsxs("span",{children:[Ee(r.totalStaked)," Volume"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-transparent bg-clip-text bg-gradient-to-r from-[#00FFFF] to-[#27FE60]",children:[e.jsx("img",{src:ht,alt:"star icon"}),e.jsxs("span",{children:[se(D),"% Potential Winnings"]})]})]}),e.jsxs("div",{className:"bg-[#1A1F3F] p-3 rounded-xl mb-6 flex justify-between items-center",children:[e.jsxs("div",{className:"text-white",children:[e.jsx("span",{className:"text-sm text-gray-400",children:j&&!W()?"Adding to prediction:":"Your prediction:"}),e.jsx("p",{className:"font-semibold",children:D==="optionA"?((Qe=r.options)==null?void 0:Qe.A)||"Option A":((Pe=r.options)==null?void 0:Pe.B)||"Option B"})]}),e.jsx("div",{className:`px-4 py-1 rounded-full ${D==="optionA"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"} ${N?"opacity-50":""}`,children:D==="optionA"?((Ie=r.options)==null?void 0:Ie.A)||"Option A":((qe=r.options)==null?void 0:qe.B)||"Option B"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{className:`w-full py-4 rounded-full font-semibold transition-colors ${ke?b&&ce&&!t?"bg-green-600 text-white":t&&ce?"bg-red-600 text-white hover:bg-red-500":N?"bg-red-600 text-white cursor-not-allowed":j&&!W()?"bg-blue-600 text-white hover:bg-blue-500":"bg-[#18DDF7] text-black hover:bg-opacity-90":"bg-[#1A1F3F] text-gray-400 cursor-not-allowed"}`,disabled:!ke&&!(t&&ce),onClick:m,children:a()})}),(o||z)&&e.jsx("div",{className:`text-center mb-4 p-3 rounded-lg ${z?"bg-red-900 bg-opacity-20 text-red-500":o.includes("Success")||o.includes("successful")?"bg-green-900 bg-opacity-20 text-green-500":o.includes("failed")||o.includes("Failed")?"bg-red-900 bg-opacity-20 text-red-500":(o.includes("Refreshing"),"bg-blue-900 bg-opacity-20 text-blue-400")}`,children:z||o}),ne&&x&&e.jsxs("div",{className:"p-3 mb-4 border rounded-lg bg-yellow-500/10 border-yellow-500/30",children:[e.jsxs("p",{className:"text-sm text-center text-yellow-400",children:["üîÑ Processing ",j?"additional ":"","stake of"," ",ne," ",ue," on ",Ne,"..."]}),e.jsx("p",{className:"mt-1 text-xs text-center text-yellow-300",children:"Balance will update after transaction confirms"})]}),j&&!W()&&c&&e.jsxs("div",{className:"p-3 mb-4 border rounded-lg bg-blue-500/10 border-blue-500/30",children:[e.jsxs("p",{className:"text-sm text-center text-blue-400",children:[`üí° You're adding to your existing "`,be(),'" stake']}),e.jsxs("p",{className:"mt-1 text-xs text-center text-blue-300",children:["Total stake will be:"," ",le(Y.amount,!0)," +"," ",c||"0"," ="," ",Y&&c?(parseFloat(le(Y.amount,!0))+parseFloat(c||"0")).toString():le((Y==null?void 0:Y.amount)||0,!0)," ",ue]})]})]})})})};export{Nt as default};
